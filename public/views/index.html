<!DOCTYPE html>
<html>
    <head>
    <title>SETTINGS</title>
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="altIndex.css">
    <style type="text/css">

    </style>
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    </head>

    <body>
        <header>
        <h1>SETTINGS</h1>
        <h3 id = "numPlayers">Active Players: 0 </h3>
        </header>
    <br>

        <form action="#">
            <section id="playersettings">
            <fieldset>
            <legend>Player Settings</legend>
                <div id = "Player">
                    <label for="playernum">Number of Players:</label>
                    <input id="playernum" type="number" name="playernum" min = "1" max = "4" step = "1" value = "1" title = "Max 4 players"><br>

                    <label for="hand">Starting Hand:</label>
                    <input id="hand" type="number" name="hand" min = "0" max = "52" step = "1" value = "0" title = "The amount of cards each player starts with"><br>
                </div>
            </fieldset>
            </section>
            <br>
            <section id ="gamesettings">
            <fieldset>
            <legend>Game Settings</legend>
                <div id = "Game">
                    <label for = "name"> Game Name:</label>
                    <input id = "name" type = "text" name = "name" maxlength="20" value = "Virtual Cards" title = "Limit 20 characters">
                    <input id = "updateButton" type="button" value="Update Name" title= "Update and refresh current game name">
                    <br>
                </div>
            </fieldset>
        </section>
        <br>
        <section id="submit">
            <input type="reset" name="reset" value="Reset">
            <input id = "GameButton" type="button" value="Create Game" title= "Start new game - this will clear any previous game history" onClick="SetGame()">
            <!--<input id = "end" type="button" value="End Game" title= "End the Current Running Game">-->
        </section>
        </form>

        <script>
            function SetGame(){
                $.post("/create", {playernum:$("#playernum").val(), handnum:$("#hand").val(), name:$("#name").val()},success);
            }
            /////////////////////////////////////////////////////////////////////////////////////////////////////////
            function UpdateGame(){
                $.post("/update", {name:$("#name").val()},success);
            }
            /////////////////////////////////////////////////////////////////////////////////////////////////////////
            function EndGame(){
                $.get("/end",success);
            }
            /////////////////////////////////////////////////////////////////////////////////////////////////////////
            function success(data) {
                switch(data.error) {
                    // case 0: alert("Game Created!");;break;
                    case 1: alert("Invalid Starting Hand");break;
                    case 2: alert("No Current Game");break;
                    case 3: alert("Name Updated");break;
                    case 4: alert("Text Inputs Can Only Include Letters And Numbers");break;
                    // case 5: alert("Game Ended");break;
                    // case 6: alert("Bad Create: Game In Progress");break;
                }
                if($("#GameButton").val() == "Create Game"){
                    $("#GameButton").val("End Game");
                    $("#GameButton").attr( 'title',"End the Current Running Game");
                    $("#GameButton").attr( 'onClick',"EndGame()");
                }
                else if($("#GameButton").val() == "End Game"){
                    $("#GameButton").val("Create Game");
                    $("#GameButton").attr( 'title',"Start new game - this will clear any previous game history");
                    $("#GameButton").attr( 'onClick',"SetGame()");
                }
            }
            /////////////////////////////////////////////////////////////////////////////////////////////////////////
            check();
            function check() {
                $.get("/indexCheck",{playernum:parseInt($("#playernum").val())}, checkSuccess);
                let numMilliSeconds = 250;
                setTimeout(check, numMilliSeconds);
            }
            /////////////////////////////////////////////////////////////////////////////////////////////////////////
            function checkSuccess(data){
                document.getElementById("numPlayers").innerHTML = "Active Players: " + data.active;
                if(data.gameactive == true){
                    $('#playernum').attr("disabled", true);
                    $('#hand').attr("disabled", true);

                    $("#GameButton").val("End Game");
                    $("#GameButton").attr( 'title',"End the Current Running Game");
                    $("#GameButton").attr( 'onClick',"EndGame()");
                }
                else if(data.gameactive == false){
                    $('#playernum').removeAttr("disabled");
                    $('#hand').removeAttr("disabled");

                    $("#hand").attr( 'max',data.maxhand);
                    if($("#hand").val() > data.maxhand){
                        $("#hand").val(data.maxhand)
                    }
                    $("#GameButton").val("Create Game");
                    $("#GameButton").attr( 'title',"Start new game - this will clear any previous game history");
                    $("#GameButton").attr( 'onClick',"SetGame()");
                }
            }
            /////////////////////////////////////////////////////////////////////////////////////////////////////////
            $(document).ready(function(){
                console.log("ready");
                //$("#GameButton").click(SetGame);
                $("#updateButton").click(UpdateGame);
                //$("#end").click(EndGame);
                $.get("/start",function(data){
                    if(!data)
                        return;
                    $("#playernum").val(data.playernum);
                    $("#hand").val(data.handnum);
                    $("#name").val(data.gamename);
                });
            });
        </script>
    </body>
</html>
